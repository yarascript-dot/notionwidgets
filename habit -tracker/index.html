<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Habit Tracker Widget</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #f0f0f0;
    font-family: sans-serif;
  }

  .widget {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    border: 4px solid #333;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.5rem;
    color: #fff;
    text-align: center;
    transition: background 0.3s ease;
  }
</style>
</head>
<body>
<div class="widget" id="habit-widget">0%</div>

<script>
const NOTION_API_KEY = "—Ç—É—Ç_—Ç–≤—ñ–π_—Å–µ–∫—Ä–µ—Ç–Ω–∏–π_–∫–ª—é—á";
const DATABASE_ID = "—Ç—É—Ç_—Ç–≤—ñ–π_id_–±–∞–∑–∏";

async function getTodayProgress() {
  const res = await fetch(`https://api.notion.com/v1/databases/${DATABASE_ID}/query`, {
    method: "POST",
    headers: {
      "Authorization": `Bearer ${NOTION_API_KEY}`,
      "Notion-Version": "2022-06-28",
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      filter: {
        property: "Day",
        date: { equals: new Date().toISOString().split("T")[0] }
      }
    })
  });

  const data = await res.json();
  if (!data.results || data.results.length === 0) return 0;

  const progress = data.results[0].properties["Progress %"].number || 0;
  return progress;
}

function getWidgetStyle(progress) {
  if (progress === 100) return { bg: "#0f9d58", text: "üíØ" };   // –∑–µ–ª–µ–Ω–∏–π
  if (progress >= 80) return { bg: "#34a853", text: "üü¢" };     // —Å–≤—ñ—Ç–ª—ñ—à–µ –∑–µ–ª–µ–Ω–∏–π
  if (progress >= 60) return { bg: "#fbbc05", text: "üü°" };     // –∂–æ–≤—Ç–∏–π
  if (progress >= 40) return { bg: "#f9ab00", text: "üü†" };     // –ø–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π
  if (progress >= 20) return { bg: "#ea4335", text: "üî¥" };     // —á–µ—Ä–≤–æ–Ω–∏–π
  return { bg: "#808080", text: "‚¨õ" };                           // —Å—ñ—Ä–∏–π
}

async function updateWidget() {
  const progress = await getTodayProgress();
  const widget = document.getElementById("habit-widget");
  const style = getWidgetStyle(progress);
  widget.style.backgroundColor = style.bg;
  widget.textContent = style.text + " " + progress + "%";
}

// –æ–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–∂–µ—Ç –æ–¥—Ä–∞–∑—É —ñ –∫–æ–∂–Ω—ñ 5 —Ö–≤
updateWidget();
setInterval(updateWidget, 5 * 60 * 1000);
</script>
</body>
</html>
